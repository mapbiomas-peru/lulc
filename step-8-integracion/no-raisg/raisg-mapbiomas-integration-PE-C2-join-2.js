/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var de21a25 = 
    /* color: #8000d6 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.9228592594099, -17.94278026797784],
                  [-70.90826804236889, -17.922691682540606],
                  [-70.95492370504348, -17.901387548688476],
                  [-70.96600935389324, -17.895346668359817],
                  [-70.97051546503826, -17.89673519139345],
                  [-70.97818321264617, -17.891916814408212],
                  [-70.98432010687225, -17.888322870176772],
                  [-70.98693794287078, -17.887261009091773],
                  [-70.98788208044402, -17.887261009091773],
                  [-70.9966056308979, -17.881254979790395],
                  [-71.00179467878313, -17.878308936169258],
                  [-71.00672605510712, -17.874954331820877],
                  [-71.01856238499131, -17.869796692869848],
                  [-71.03399667278666, -17.887580403095097]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.1264953727712, -7.927572566763084],
                  [-79.12177468490499, -7.930632930581289],
                  [-79.11834145736593, -7.92493723523466],
                  [-79.12546540450948, -7.922471909819336]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.09371670379574, -7.956664951289049],
                  [-79.0894251693719, -7.959300079234646],
                  [-79.08882435455257, -7.952924740605972]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.07868745802088, -7.99118724484299],
                  [-79.07400968549891, -7.989954783198851],
                  [-79.07143476484461, -7.98128494788799],
                  [-79.08306482313318, -7.981709944103946]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.88043689509824, -5.8965529240291925],
                  [-80.87065219661191, -6.052257719875957],
                  [-80.71022977230147, -5.996258323530305],
                  [-80.68783283015684, -5.850789206197747],
                  [-80.8198529388937, -5.843001569399122],
                  [-80.89873134160366, -5.845221568818199]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.06451169922467, -5.359377383453756],
                  [-80.06906072571392, -5.367196509267455],
                  [-80.07296602203961, -5.3728364722173625],
                  [-80.07648508026715, -5.375485527705641],
                  [-80.07532636597271, -5.376895504153471],
                  [-80.06811658814068, -5.370828309574241],
                  [-80.06369630768414, -5.3649746913570775],
                  [-80.0616363711607, -5.360445575947259]]]),
            {
              "class_original": 21,
              "class_final": 25,
              "system:index": "5"
            })]),
    de4a11 = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.65872417083847, -8.905953361273056],
                  [-78.63898311248886, -8.901204760308781],
                  [-78.66679225555527, -8.856938054703264],
                  [-78.68704829803573, -8.867962829454225]]]),
            {
              "class_original": 4,
              "class_final": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.44401051700544, -7.665644275292804],
                  [-79.43268086612653, -7.698052290809283],
                  [-79.42366864383649, -7.689971783503774],
                  [-79.43216588199567, -7.664963765543126]]]),
            {
              "class_original": 4,
              "class_final": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.45006019827913, -7.733788608198472],
                  [-79.42731506583284, -7.760578498313452],
                  [-79.41770202872347, -7.755730930239142],
                  [-79.4299245826115, -7.7352229399348875],
                  [-79.4265203659527, -7.718425385819333],
                  [-79.42677785801813, -7.7108555950479145],
                  [-79.44308568882867, -7.710175157781742]]]),
            {
              "class_original": 4,
              "class_final": 11,
              "system:index": "2"
            })]),
    de4a21 = 
    /* color: #ffc82d */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.98051716137022, -8.215068937731207],
                  [-78.96618419015368, -8.122799181348157],
                  [-79.05356024757785, -8.079293444622115],
                  [-79.05750884287939, -8.054734355806808],
                  [-79.08600424782199, -8.053119133513185],
                  [-79.13389764910991, -8.032637403285394],
                  [-79.14763068214816, -8.047510132261289],
                  [-79.10540198341769, -8.103256747720142],
                  [-79.06488989845676, -8.13843432986705]]]),
            {
              "class_original": 4,
              "class_final": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.32592376297045, -7.663535243623036],
                  [-79.38995345657396, -7.659452148589373],
                  [-79.42565902298021, -7.700621561339522],
                  [-79.42274077957201, -7.729539832767773],
                  [-79.4253157002263, -7.73481295127912],
                  [-79.4059179646306, -7.768831484365142],
                  [-79.36317137669957, -7.877939578926471],
                  [-79.33021239232457, -7.910926273396513],
                  [-79.23751524876988, -7.999331172095042],
                  [-79.21910447710223, -7.981857719962789],
                  [-79.21721620195575, -7.964007505043616],
                  [-79.20777482622333, -7.967747614561887],
                  [-79.19645918909032, -7.968231520302771],
                  [-79.19242514673192, -7.949445647500028],
                  [-79.1907980368772, -7.945285380258273],
                  [-79.18504738074927, -7.943925269868526],
                  [-79.18487571937231, -7.936444582210738],
                  [-79.21717323828683, -7.857250713250339],
                  [-79.25768532324777, -7.896020248700794],
                  [-79.26798500586496, -7.941246774118314],
                  [-79.28304495137792, -7.946518011284505],
                  [-79.28788898604792, -7.943219665103978],
                  [-79.28608654158991, -7.937694160831598],
                  [-79.28291080611628, -7.922647411169971],
                  [-79.26402427976097, -7.858002427206667],
                  [-79.19046668155076, -7.813502378187929],
                  [-79.15643989397984, -7.782576621509908],
                  [-79.15674868990585, -7.747566777233059],
                  [-79.18009569151361, -7.726219204263199],
                  [-79.19090930391953, -7.7000227179137495],
                  [-79.22605604962521, -7.709358449764436],
                  [-79.24129056885991, -7.708315950018536],
                  [-79.2616760872631, -7.729940662442794],
                  [-79.3027031563549, -7.692176443352042]]]),
            {
              "class_original": 4,
              "class_final": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.89890958574175, -6.689602966253207],
                  [-79.89897937712944, -6.6916267993509155],
                  [-79.89573123319123, -6.691487879604183],
                  [-79.89442905116405, -6.690459380454274],
                  [-79.89377797510186, -6.690435296006559],
                  [-79.89261559240578, -6.690124888912413],
                  [-79.89203441029446, -6.690118863029443],
                  [-79.89228026492016, -6.6921830648456035],
                  [-79.89251047038137, -6.697328236674435],
                  [-79.8823687820588, -6.697513903957332],
                  [-79.87234467805223, -6.685711037418211],
                  [-79.88163249250039, -6.67953445742509],
                  [-79.88415773183894, -6.677155285718019],
                  [-79.89262315892323, -6.677196411764708],
                  [-79.89491983005098, -6.677385202938302],
                  [-79.89668075063045, -6.6807677821185445],
                  [-79.89801389561148, -6.680734400854065],
                  [-79.89857733015684, -6.680859445704033],
                  [-79.89906046472936, -6.680640674111151],
                  [-79.89959757585997, -6.6811408527810165],
                  [-79.8997705773768, -6.6845281130349745],
                  [-79.8998161730382, -6.6848238196131575],
                  [-79.90029897188101, -6.683747575056485],
                  [-79.90111436342154, -6.683811510570598],
                  [-79.90175809358512, -6.684685295092238],
                  [-79.90205850099478, -6.685559078052098],
                  [-79.90160788988028, -6.68592137784568],
                  [-79.90109290574942, -6.686752535180854]]]),
            {
              "class_original": 4,
              "class_final": 21,
              "system:index": "2"
            })]),
    de3a4 = 
    /* color: #bf04c2 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.21712285899979, -7.052682957383537],
                  [-79.12511236095291, -7.187590303968611],
                  [-78.8992059888826, -7.1916777839375206],
                  [-78.88753301524979, -7.1371750337461695],
                  [-78.89645940685135, -7.106855065602868],
                  [-78.95036107921463, -7.091183286089291],
                  [-79.00288946056229, -7.0533644070064225],
                  [-79.07636052989822, -7.03769081216065],
                  [-79.11034948253494, -6.95181740853287],
                  [-79.18141729259354, -6.875131457487017],
                  [-79.22261602306229, -6.878539985807342]]]),
            {
              "class_original": 3,
              "class_final": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.16627522161164, -6.831536196929768],
                  [-79.10516377141633, -6.809037243358225],
                  [-79.13537617376008, -6.771195716809679],
                  [-79.11073173951324, -6.718509540921079],
                  [-79.16669334839996, -6.692595502015974],
                  [-79.23738969499234, -6.673180257228157],
                  [-79.24082292253141, -6.762513232305093]]]),
            {
              "class_original": 3,
              "class_final": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.89471477182124, -4.489003928829077],
                  [-79.86879581861957, -4.55865315938],
                  [-79.8051075330517, -4.550952079191125],
                  [-79.86656230600093, -4.4212314235875825],
                  [-79.89849132211421, -4.427392817993167]]]),
            {
              "class_original": 3,
              "class_final": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.09929566963146, -4.742537781819466],
                  [-80.0850594331741, -5.046992988140561],
                  [-79.97965278647635, -5.051123896552912],
                  [-79.99269905112479, -4.942362186727986],
                  [-79.99990882895682, -4.923549377047442],
                  [-80.03424110434744, -4.814766762036752],
                  [-79.93193092368338, -4.694333027890242],
                  [-79.92918434165213, -4.654982247997895],
                  [-80.02565803549979, -4.666616621586443]]]),
            {
              "class_original": 3,
              "class_final": 4,
              "system:index": "3"
            })]),
    de21a4 = 
    /* color: #ff0000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.62273655909199, -6.125186294533763],
                  [-80.3212991811623, -6.089000617022691],
                  [-80.3927103139748, -5.670985474457189],
                  [-80.58977757471699, -5.686700812584401]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.09694165473601, -5.7858495868094835],
                  [-80.08861607795379, -5.7935349437758505],
                  [-80.07857388740203, -5.78226305113617],
                  [-80.09153432136199, -5.776200046281278]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.0075861107471, -5.732289131774038],
                  [-80.00054799429202, -5.741768618066714],
                  [-79.98518430105472, -5.731520517873719],
                  [-79.99900304189944, -5.7223824733620345]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.9788443019182, -5.710255360670427],
                  [-79.9704328944475, -5.71777093177493],
                  [-79.96476806900804, -5.706839159391013],
                  [-79.97197784684008, -5.702227255377299]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.19729661919659, -5.6504159103246385],
                  [-80.18905687310284, -5.653490793558533],
                  [-80.1910309789378, -5.644351509434923]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.30051298261205, -5.203801302353629],
                  [-80.30368871808568, -5.211579654626425],
                  [-80.30025549054662, -5.210895847296976],
                  [-80.29699392438451, -5.205168931703505]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.2922732365183, -5.212947267052099],
                  [-80.2908141148142, -5.215084155504553],
                  [-80.28781004071752, -5.2104684673381225],
                  [-80.29072828412572, -5.209699182679598]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.28120107770482, -5.200211261166733],
                  [-80.27931280255834, -5.184141302278997],
                  [-80.28120107770482, -5.185167056567164],
                  [-80.28291769147435, -5.189953887872538],
                  [-80.28429098248998, -5.199271008900808]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.26351995587865, -5.190381281758864],
                  [-80.26085920453588, -5.1902103242390885],
                  [-80.2611166966013, -5.187560476758358],
                  [-80.26326246381322, -5.187133080961256]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.2772528660349, -5.182431708096395],
                  [-80.27502126813451, -5.179525387368737],
                  [-80.27708120465795, -5.177388378307704],
                  [-80.27879781842748, -5.1812349894156675]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.2970627805455, -5.234496641343608],
                  [-80.30006685464218, -5.245180643079803],
                  [-80.29568948952988, -5.2466336531962],
                  [-80.29311456887558, -5.233385494678495]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.31385592535122, -5.257236841188563],
                  [-80.31265429571255, -5.260484678651768],
                  [-80.30930689886196, -5.256724023198165]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.23658960030984, -5.282978222248417],
                  [-80.23616044686746, -5.286824184268629],
                  [-80.23345678018045, -5.283619217576669]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.2416965262742, -5.308190204451774],
                  [-80.23787706063699, -5.309813991755433],
                  [-80.2402374045701, -5.305113543099268]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.24834840463113, -5.321052191840358],
                  [-80.24362771676492, -5.3198130087380635],
                  [-80.24448602364969, -5.3175910189952935],
                  [-80.2484342353196, -5.31801832533806]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.25197430101872, -5.339503534748038],
                  [-80.2546350523615, -5.338648951654271],
                  [-80.25540752855778, -5.342067276880723]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.19755764452458, -5.355569474976703],
                  [-80.19009037462712, -5.35744950423505],
                  [-80.19026203600407, -5.352920333024715],
                  [-80.19412441698552, -5.352236681625447]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.28334888260933, -5.376187361206622],
                  [-80.27828487198921, -5.3800327393921545],
                  [-80.27570995133492, -5.375418282654439],
                  [-80.2812889460859, -5.371829236569417]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.25493892472359, -5.404728032615622],
                  [-80.24927409928414, -5.411991162711661],
                  [-80.24798663895699, -5.402420902467273],
                  [-80.2530506495771, -5.401737306661837]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.27270648433584, -5.502485306249649],
                  [-80.26549670650381, -5.508636607682899],
                  [-80.26438090755362, -5.4995805028983344],
                  [-80.26686999751944, -5.498982453389147]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.13237891503759, -5.703528631068697],
                  [-80.12233672448583, -5.708225929703542],
                  [-80.12293753930517, -5.699343732613837],
                  [-80.12825904199072, -5.697464788689281]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.06767298091191, -5.706296966777544],
                  [-80.08621240962285, -5.691265425292352],
                  [-80.0808909069373, -5.714154206704276]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.05934740412968, -5.739262489048062],
                  [-80.05299593318242, -5.736785870823095],
                  [-80.04776026118535, -5.737383676207077],
                  [-80.04552866328495, -5.734736247607008],
                  [-80.04604364741581, -5.729355951638354],
                  [-80.06226564753788, -5.731832602113662]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.06135352309137, -5.8037853863803095],
                  [-80.05551703627496, -5.801052876623954],
                  [-80.06221182997614, -5.793367621972355]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.89144870649, -5.697270175247325],
                  [-79.88861629377027, -5.703761048566015],
                  [-79.88664218793531, -5.703761048566015],
                  [-79.8888737858357, -5.695989073158082]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.87492415625981, -5.6710299634176335],
                  [-79.86977431495121, -5.6708591421843595],
                  [-79.86634108741215, -5.6617201325148585],
                  [-79.8716625900977, -5.658047405664361],
                  [-79.87466666419438, -5.667698940248385]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.87363669593266, -5.64446665507888],
                  [-79.87355086524418, -5.648822779584323],
                  [-79.87028929908207, -5.647541569893876],
                  [-79.86977431495121, -5.644210411441285],
                  [-79.87406584937504, -5.6408792338479365],
                  [-79.87775656897954, -5.640793818786271],
                  [-79.87758490760258, -5.643270850467851],
                  [-79.8768124314063, -5.644124996870264]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.04075976399847, -5.684289469738197],
                  [-80.03831358937688, -5.685912231589756],
                  [-80.03625365285345, -5.68270940775009],
                  [-80.04028769521184, -5.679805498735981]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.0474783736041, -5.5619156124503055],
                  [-80.04456013019589, -5.566443204894797],
                  [-80.04224270160702, -5.5617447592228775],
                  [-80.04533260639218, -5.558327684258044]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.99993387666012, -5.476455546624268],
                  [-79.99109331574704, -5.481111949307999],
                  [-79.98251024689938, -5.48081291536404],
                  [-79.98426977601315, -5.4669717519294085],
                  [-79.98924795594479, -5.454326458669825],
                  [-79.99860350098874, -5.4535574795322015]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.06936692933134, -5.336719173056018],
                  [-80.06915235261015, -5.329668794929552],
                  [-80.07301473359159, -5.327446840802825],
                  [-80.07511758545927, -5.337189195384137]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.25291512634784, -5.170732063409793],
                  [-80.25673459198505, -5.169492581807695],
                  [-80.25926659729511, -5.169749026476155],
                  [-80.25540421631366, -5.177399577966736]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.26202111186069, -5.13210739071946],
                  [-80.26030449809116, -5.132962256160214],
                  [-80.26008992136997, -5.131423497542071],
                  [-80.26139883936924, -5.130568630039492]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.27844897223817, -5.111690821964223],
                  [-80.27606717063294, -5.110579459686814],
                  [-80.27883521033631, -5.108997902352768],
                  [-80.28123846961365, -5.11117788576809]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.30615631339185, -5.13020636523705],
                  [-80.3095680832588, -5.130056763221414],
                  [-80.30950371024244, -5.133155654954546]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.3146106362068, -5.138092478957654],
                  [-80.31128469702833, -5.139502993077745],
                  [-80.31139198538892, -5.136147674065811],
                  [-80.31317297217481, -5.136340017671191]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.3179794907295, -5.135549271366803],
                  [-80.32036129233472, -5.140870761363066],
                  [-80.31883779761426, -5.141960699612365],
                  [-80.31602684256666, -5.136532361218534]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.32661516471244, -5.115430302859194],
                  [-80.32442648215628, -5.11545167506697],
                  [-80.32270986838675, -5.111070357555979],
                  [-80.3266795377288, -5.110065856146877]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.3573587998329, -5.0943341949368595],
                  [-80.35564218606336, -5.094141838708008],
                  [-80.35598550881727, -5.090957266110643],
                  [-80.35716568078382, -5.091919051443494]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.3923013227336, -5.092624359773298],
                  [-80.38899684122725, -5.092496121952693],
                  [-80.38929724863692, -5.091384726436161],
                  [-80.39234423807784, -5.090871774011439]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.4049613492839, -5.097283649902045],
                  [-80.40144229105636, -5.092196900271837],
                  [-80.40805125406905, -5.087965035878141],
                  [-80.4104545133464, -5.0919404244345525]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.35554557469278, -5.078426909133414],
                  [-80.34820705082804, -5.08056424951868],
                  [-80.35043864872843, -5.072442318369099]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.27300219415812, -5.05583880232952],
                  [-80.27175764917521, -5.053487637553407],
                  [-80.27188639520793, -5.050281490018933],
                  [-80.27089934229045, -5.049234145054937],
                  [-80.27044873117595, -5.0486142870344946],
                  [-80.27188639520793, -5.04844329161425],
                  [-80.27295927881389, -5.049084524207696],
                  [-80.27315239786296, -5.051115089903554],
                  [-80.27459006189494, -5.051136464245483],
                  [-80.27474026559977, -5.052012811657385],
                  [-80.27405362009196, -5.05254716925384],
                  [-80.27396778940349, -5.055218950626015]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.0788333203847, -5.310516248731506],
                  [-80.0797345426137, -5.312610071029091],
                  [-80.07664772239524, -5.312208292307724]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-81.00619742541225, -5.176594466928251],
                  [-80.98422476916225, -5.1523175072766785],
                  [-81.02645346789272, -5.120174754209397],
                  [-81.0557751071869, -5.153155378120948]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.74764968862982, -4.768799472882802],
                  [-80.70936920156927, -4.74715914014142],
                  [-80.69793741997265, -4.654121405166103],
                  [-80.68892592117652, -4.630770107153736],
                  [-80.74484416552096, -4.586070794831482],
                  [-80.79664240008704, -4.628973944114811],
                  [-80.84865610893749, -4.659938623155925],
                  [-80.9180587108468, -4.681521252763538],
                  [-80.90859620872006, -4.756805873806049]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.89463704554439, -4.590435302239203],
                  [-80.830264245985, -4.4805733093529],
                  [-80.74177476163327, -4.435908847737393],
                  [-80.76963157708472, -4.326452596398431],
                  [-80.89772695032954, -4.323795943614104],
                  [-81.06508976203082, -4.300176444965601],
                  [-81.07316487757564, -4.443607352895383],
                  [-81.1179684969604, -4.485879044941711],
                  [-81.10457890955806, -4.505559363765709],
                  [-80.9512056538648, -4.616450008436346]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.72589379635666, -3.9724390927310895],
                  [-80.84502679196213, -4.016277657207558],
                  [-80.84125024166916, -4.035285054359621],
                  [-80.85227151640842, -4.042767973492705],
                  [-80.85660596617649, -4.0467063512703625],
                  [-80.86634774931858, -4.0510727912006645],
                  [-80.85043691352372, -4.0850910957719],
                  [-80.96366466170592, -4.12128260926244],
                  [-80.99044383651061, -4.167509982098957],
                  [-80.98563731795592, -4.193190683580307],
                  [-80.8998865885902, -4.296828611887821],
                  [-80.7618708415199, -4.298882755743856],
                  [-80.6523508830238, -4.112275764117766],
                  [-80.67226360275036, -4.067757474764476],
                  [-80.72444866134411, -4.038648030733853]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.57959484044424, -4.173689254035624],
                  [-80.55865215245596, -4.183961554680284],
                  [-80.5171100992333, -4.115819458849597],
                  [-80.501987627101, -4.096848209283835],
                  [-80.50800812680112, -4.0954500069984014],
                  [-80.5113555236517, -4.097932737115115],
                  [-80.51787865597592, -4.0933097162323335],
                  [-80.54379952389584, -4.094765114575945]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.50610336241394, -4.072956837086711],
                  [-80.49228462156921, -4.072871223166118],
                  [-80.50644668516784, -4.054549634914069],
                  [-80.52292617735534, -4.062939946612073]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.48643257722841, -4.158777357687451],
                  [-80.4831710110663, -4.163571205667217],
                  [-80.4680918557097, -4.1532807202480715],
                  [-80.46328533715501, -4.1311942480306705],
                  [-80.47238339013353, -4.129310876937338]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.5923982722943, -4.220069604213329],
                  [-80.58450184895446, -4.2058602094926885],
                  [-80.58759175373962, -4.19627300153266],
                  [-80.60613118245055, -4.212708142967804]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.72050944212108, -4.300911916306024],
                  [-80.71793452146679, -4.344903379665059],
                  [-80.62334910276562, -4.341993517484163],
                  [-80.62420740965038, -4.30108309425502]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.96163782803406, -4.031468278943053],
                  [-80.98987614387397, -4.035149860416212],
                  [-81.02214849289186, -4.04568080403633],
                  [-81.0385527209869, -4.069128601038907],
                  [-81.02663327091373, -4.081788782562007],
                  [-80.99695725984922, -4.07577456355605],
                  [-80.98944699015513, -4.063403300892805],
                  [-80.96747431874682, -4.063060840831141],
                  [-80.95880541329807, -4.048334921955112],
                  [-80.95511469118765, -4.04242735590993],
                  [-80.95459970671241, -4.04071500987975]]]),
            {
              "class_original": 21,
              "class_final": 4,
              "system:index": "53"
            })]),
    de33a4 = 
    /* color: #ff79fd */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.95658238296012, -5.521563854216581],
                  [-79.94327862624625, -5.519855202977338],
                  [-79.95143254165153, -5.505416903549523]]]),
            {
              "class_original": 33,
              "class_final": 4,
              "system:index": "0"
            })]),
    de5a4 = 
    /* color: #4ad4d6 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.6861877884836, -3.554123610694247],
                  [-81.3124084916086, -4.17069793666309],
                  [-81.39205937051484, -4.381595908762018],
                  [-81.1860657181711, -4.485653689843545],
                  [-80.6037903275461, -3.97344335528649],
                  [-80.15060429238984, -3.5513823071347175],
                  [-80.19454960488984, -3.460914760541298],
                  [-80.51383976602266, -3.6240240818010796]]]),
            {
              "class_original": 5,
              "class_final": 4,
              "system:index": "0"
            })]),
    de33a30 = /* color: #f6f658 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.57430990663856, -16.533985060457645],
                  [-71.57518965857918, -16.53639175070535],
                  [-71.57665951511176, -16.53767738242459],
                  [-71.57683655510544, -16.534658714745518],
                  [-71.57842711265356, -16.533437328980384],
                  [-71.58119651440636, -16.534060852548688],
                  [-71.58145972669882, -16.535780073085363],
                  [-71.58069296495529, -16.538486663083155],
                  [-71.57697067332352, -16.541431407763596],
                  [-71.57364469816413, -16.54038236102779],
                  [-71.57104834047645, -16.53735858002131],
                  [-71.56864508119911, -16.535712968088983],
                  [-71.56864508119911, -16.53209257244537],
                  [-71.57250746218055, -16.531598876868898],
                  [-71.57246454263779, -16.530899470711606],
                  [-71.57579047654082, -16.531537159729567],
                  [-71.57839490478332, -16.530506055363617],
                  [-71.57909630363636, -16.53097789426652],
                  [-71.57851024244415, -16.531449733153597],
                  [-71.5751360269723, -16.533007957858032]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.58527477709144, -16.5358775299137],
                  [-71.58308608439492, -16.53690604460038],
                  [-71.5816806077644, -16.53445818368063],
                  [-71.5814982189867, -16.53334739180792],
                  [-71.57911642519325, -16.53258626675919],
                  [-71.58006056276649, -16.529130380047505],
                  [-71.58503874269813, -16.532010289936984],
                  [-71.58555372682899, -16.534273035609377]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.57121181347527, -16.550578483324657],
                  [-71.56803607800164, -16.553211252760246],
                  [-71.56949519970574, -16.554938988161695],
                  [-71.56880855419793, -16.55658443605073],
                  [-71.55945300915398, -16.55641989189397],
                  [-71.55953883984246, -16.555103533582727],
                  [-71.5604829774157, -16.551483501873488],
                  [-71.5656328187243, -16.544325511836668],
                  [-71.57438751028019, -16.547698874458266],
                  [-71.5737009034411, -16.54893298417036]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.57820106395756, -16.543090778931983],
                  [-71.57794357189213, -16.545723650599786],
                  [-71.57408119091069, -16.546135033551263],
                  [-71.57390952953374, -16.543255334464124],
                  [-71.57665611156499, -16.542021164551368]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.56172157177006, -16.53911262481478],
                  [-71.55528427013432, -16.535739135914806],
                  [-71.55494094738042, -16.532694717260632],
                  [-71.55991912731207, -16.529650250588148],
                  [-71.56408191492581, -16.529609140485924],
                  [-71.5649616793708, -16.526297189213366],
                  [-71.56721473583258, -16.52973253410248],
                  [-71.5668285075959, -16.53442259486257],
                  [-71.56663539190984, -16.538413217997075],
                  [-71.5652406299976, -16.53845438770942]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.58523918041264, -16.524301746939095],
                  [-71.58256772016979, -16.52613263711654],
                  [-71.58006788769971, -16.526811503323454],
                  [-71.58073307700231, -16.524713262527207],
                  [-71.57737496008235, -16.525556703091308],
                  [-71.57782288803811, -16.529511483524704],
                  [-71.57745542210424, -16.529969192263597],
                  [-71.57378346351696, -16.528452073120913],
                  [-71.5729560088357, -16.527960935466677],
                  [-71.57238603948889, -16.527510944711928],
                  [-71.57313705333745, -16.524795461174442],
                  [-71.5747678364185, -16.520269700110386],
                  [-71.58609748729741, -16.520269700110386]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.5952352776065, -16.536374151993353],
                  [-71.59334700246002, -16.538102038233603],
                  [-71.59291784901764, -16.53546906255006]]]),
            {
              "class_original": 33,
              "class_final": 30,
              "system:index": "6"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/


// Integracion join 
var pais = 'PERU';
var id_pais = 8;
var inputAsset = 'projects/mapbiomas-raisg/MAPBIOMAS-PERU/COLECCION2/INTEGRACION/integracion-region';
var outputAsset = 'projects/mapbiomas-raisg/MAPBIOMAS-PERU/COLECCION2/INTEGRACION/integracion-pais';
var version_input = 2
var outputVersion = 2; 
var years = [1985,2021, 2022]  // Lista de a√±os Solo para visualizacion

// Asset o featurecollecion para remap
var assetsRemap = [
    // 'projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/AJUSTES3/PERU',
     de3a4,de4a11, de4a21,de5a4,de21a4,de21a25,de33a4, de33a30    //costa
  ];
// import modules
// var Legend = require('users/joaovsiqueira1/packages:Legend.js');
var palettes = require('users/mapbiomas/modules:Palettes.js');
// var mapbiomasPalette = palettes.get('classification8');
var mapbiomasPalette = [
                      "#ffffff",
                      "#32a65e",
                      "#32a65e",
                      "#1f8d49",
                      "#7dc975",
                      "#04381d",
                      "#026975",
                      "#000000",
                      "#000000",
                      "#7a6c00",
                      "#ad975a",
                      "#519799",
                      "#d6bc74",
                      "#d89f5c",
                      "#FFFFB2",
                      "#edde8e",
                      "#000000",
                      "#000000",
                      "#f5b3c8",
                      "#C27BA0",
                      "#db7093",
                      "#ffefc3",
                      "#db4d4f",
                      "#ffa07a",
                      "#d4271e",
                      "#ffa2fa", //  "#db4d4f",
                      "#0000FF",
                      "#000000",
                      "#000000",
                      "#ffaa5f",
                      "#9c0027",
                      "#091077",
                      "#fc8114",
                      "#2532e4",
                      "#93dfe6",
                      "#9065d0",
                      "#d082de",
                      "#000000",
                      "#000000",
                      "#f5b3c8",
                      "#c71585",
                      "#f54ca9",
                      "#cca0d4",
                      "#dbd26b",
                      "#807a40",
                      "#e04cfa",
                      "#d68fe2",
                      "#9932cc",
                      "#e6ccff",
                      "#02d659",
                      "#ad5100",
                      "#000000",
                      "#000000",
                      "#000000",
                      "#000000",
                      "#000000",
                      "#000000",
                      "#CC66FF",
                      "#FF6666",
                      "#006400",
                      "#8d9e8b",
                      "#f5d5d5",
                      "#ff69b4"
                    ]

/**
 * Export to asset
 */
var assetCountry = "projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/paises-5";
var paisraster = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/paises-5';
var asset_lim_raisg_raster = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/limite-raisg-5';
var asset_lim_raisg_vect = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/limite-raisg-5';
var assetregionVectors= 'projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/PERU/per-clasificacion-regiones-5'

var regMosaic = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/clasificacion-mosaicos-4'

// clasificacion coleccion 4 se usa para rellenar los pixeles 27 de la col4
var assetRaisgC5 = 'projects/mapbiomas-raisg/COLECCION5/INTEGRACION/integracion-pais/PERU-4';
var Raisg_peruC5 = ee.Image(assetRaisgC5);
// Raisg_peruC5 = Raisg_peruC5.addBands(
//     Raisg_peruC5.select(['classification_2021'], ['classification_2022']));
    
var countries = ee.FeatureCollection(assetCountry);
var lim_raisg = ee.Image(asset_lim_raisg_raster);
var lim_raisg_vect = ee.FeatureCollection(asset_lim_raisg_vect)
var regionVectors = ee.FeatureCollection(assetregionVectors)

print(countries)
var country = countries.filter(ee.Filter.eq('featureid', id_pais));
var countryMask = ee.Image(paisraster).eq(id_pais).selfMask();

var maskRaisg = lim_raisg.eq(1).and(countryMask.eq(1)).selfMask()

Map.addLayer(country,{},'COUNTRY', false)
Map.addLayer(lim_raisg_vect,{},'lim_raisg',false)

var integrated = ee.Image()//.select()
// print(integrated)

// Integrate
// assetList.forEach(function(id){
//   var imageIntegrate = ee.Image(inputAsset+id);
//   integrated = integrated.blend(imageIntegrate)
  
// })
var integrated = ee.ImageCollection(inputAsset).filter(ee.Filter.eq('pais', pais))
                                               .filter(ee.Filter.eq('version', version_input))
                                               .mosaic()
print(integrated)
// Map.addLayer(country.geometry().bounds(),{},'country')
integrated = integrated.blend(Raisg_peruC5.updateMask(maskRaisg))
                       .unmask(27)
                       .mask(countryMask)
                      // .mask(assetRaisgC5);

// REMAP------------------------------------------------------------------------------------

  // load remap polygons
  var remapCollection = ee.FeatureCollection(
      assetsRemap.map(
          function (item) {
              return ee.FeatureCollection(item);
          }
      )
  ).flatten();
  
  // Get remap masks
  var integratedRemaped = remapCollection.iterate(
      function (feature, image) {
          image = ee.Image(image);
  
          var polygon = ee.FeatureCollection(feature);
          var original = ee.Image().paint(polygon, 'class_original')
              .clipToBoundsAndScale(polygon.geometry(), null, null, null, 30);
  
          var final = ee.Image().paint(polygon, 'class_final')
              .clipToBoundsAndScale(polygon.geometry(), null, null, null, 30);
  
          return image.where(image.eq(original), final);
      },
      integrated
  );
  
  
  integratedRemaped = ee.Image(integratedRemaped);
  integratedRemaped = integratedRemaped
                            // .where(integratedRemaped.eq(27), 0)
                            // .selfMask()
                            // .unmask(Raisg_peruC5)
                            .mask(countryMask)
                            // .mask(maskRaisg);
//------------------------------------------------------------------------------------





// Map.addLayer(integrated,{
//                 'bands': 'classification_2021',
//                 'min': 0,
//                 'max': 62,
//                 'palette': mapbiomasPalette,
//                 'format': 'png'
//             }, 'integrated')


// Map.addLayer(integratedRemaped,{
//                 'bands': 'classification_2021',
//                 'min': 0,
//                 'max': 62,
//                 'palette': mapbiomasPalette,
//                 'format': 'png'
//             }, 'integratedRemaped')




Export.image.toAsset({
  'image': integratedRemaped.byte(),
  'description': pais + '-' + outputVersion,
  'assetId': outputAsset + '/' + pais + '-' + outputVersion,
  'pyramidingPolicy': {
      ".default": "mode"
  },
  'region': country.geometry().bounds(),
  'scale': 30,
  'maxPixels': 1e13
});




var regionesMosaicRaster = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/clasificacion-mosaicos-4'
var assetMosaic = "projects/nexgenmap/MapBiomas2/LANDSAT/PANAMAZON/mosaics-2";
var assetMosaicP2 = 'projects/mapbiomas-raisg/MOSAICOS/mosaics-2';
var regionMosaicRaster  = ee.Image(regionesMosaicRaster).rename(['regions'])



/**
  * Get mosaics
  * Get mosaics from collection2 asset col4 mapbiomas Amaz. Then compute
  * wetlands indexes remaining.
  */
var getMosaic = function(paths, regionRaster, Listyears) {
  
      // Mosaic
      regionRaster = regionRaster.where(regionRaster.eq(211),210)
      regionRaster = regionRaster.where(regionRaster.eq(205),210)
      var Mosaic_coll = ee.ImageCollection(paths[0]).merge(ee.ImageCollection(paths[1]))
                                                    .filter(ee.Filter.inList('year',Listyears))
                        .filterMetadata('country', 'equals', pais)
                        // .select(['swir1_median', 'nir_median', 'red_median'])
                        .map(
                            function (image) {
                                return image.updateMask(
                                    regionRaster.eq(ee.Number.parse(image.get('region_code')).toInt16()));
                            }
                        );
                        
                          

      // Aditional Bands
      var joinedMosaics = Mosaic_coll;
                  
      
      // Select variables
      return joinedMosaics;
      
  };

var mosaicsRAISG = getMosaic([assetMosaic,assetMosaicP2], regionMosaicRaster, years);

for (var yearI=0;yearI<years.length;yearI++) {
  var vis = {
      'bands': 'classification_'+years[yearI],
           'min': 0,
           'max': 62,
           'palette': mapbiomasPalette,
  };
  
  var mosaicYear = mosaicsRAISG
                    .filterMetadata('year', 'equals', years[yearI])
                    .mosaic();
  
  Map.addLayer(mosaicYear,{
          "bands":["swir1_median","nir_median","red_median"],
          // "min":407,"max":3381,
          'gain': [0.08, 0.06, 0.08],
          'gamma': 0.65
  }, 'Mosaic' + years[yearI],false);
  
  Map.addLayer(integrated, vis, 'classification_'+years[yearI],false);

  Map.addLayer(integratedRemaped, vis, 'classification_remap_'+years[yearI],false);

}

Map.addLayer(regionVectors,{},'regionVectors',false)


